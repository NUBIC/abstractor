- abstractor_abstraction ||= @abstractor_abstraction
- unless abstractor_abstraction.blank?
  - abstractor_abstraction_schema   = abstractor_abstraction.abstractor_subject.abstractor_abstraction_schema
  - abstractor_suggestions          = abstractor_abstraction.abstractor_suggestions.order(:id)
  - rejected_suggestions            = abstractor_suggestions.joins(:abstractor_suggestion_status).where(:abstractor_suggestion_statuses => {:name => 'Rejected'})
  - about = abstractor_abstraction.about

  .abstractor_abstraction_display
    .column-3
      .abstraction_schema_name
        = abstractor_abstraction_schema.display_name
    .column-5
      .abstractor_abstraction_value
        - if rejected_suggestions.length == abstractor_suggestions.length
          %span.editable_abstraction
            = abstractor_abstraction.display_value
          = link_to 'edit', Abstractor::UserInterface.abstractor_relative_path(abstractor.edit_abstractor_abstraction_path(abstractor_abstraction)), :class=>'icon_link edit_link'
        - else
          = abstractor_abstraction.display_value
        - versions = abstractor_abstraction.versions.sort{|a,b| b.created_at <=> a.created_at}.reject{|v| v.reify.blank? || v.reify.display_value =~ /not set/i}
        - if versions.any?
          %br
          %b History:
          - versions.each do |version|
            %br
            %i
              = "#{version.reify.display_value} - #{version.created_at.to_date.to_s(:date)} (#{version.originator})"
    - if abstractor_suggestions.any?
      .column-9
        - abstractor_suggestions.each do |abstractor_suggestion|
          = form_for [abstractor_abstraction, abstractor_suggestion], url: Abstractor::UserInterface.abstractor_relative_path(abstractor.abstractor_abstraction_abstractor_suggestion_path(abstractor_abstraction, abstractor_suggestion)), method: :put, remote: true, html: { class: 'edit_abstractor_suggestion' } do |f|
            = render 'abstractor/shared/error_messages', :object => f.object
            .column-5
              .abstractor_suggestion_values
                = abstractor_suggestion.display_value
                - if abstractor_suggestion.abstractor_suggestion_sources.any?
                  - abstractor_suggestion.abstractor_suggestion_sources.each do |abstractor_suggestion_source|
                    - from_method = abstractor_suggestion_source.abstractor_abstraction_source.from_method
                    - if about.respond_to?(from_method)
                      %span{ :class => 'abstractor_abstraction_source_tooltip_img label', :rel => "#abstraction_text_#{abstractor_suggestion_source.id}", :title => "#{about.class.to_s} #{from_method}"}
                        = image_tag('abstractor/page.png', :id => "abstraction_text_link_#{abstractor_suggestion_source.id}")
                      %div{ :id => "abstraction_text_#{abstractor_suggestion_source.id}", :class => 'abstractor_abstraction_source_tooltip'}
                        - abstractable_from_column = about.send(from_method)
                        - unless abstractable_from_column.nil?
                          - if abstractor_suggestion_source.match_value
                            = Abstractor::UserInterface.highlight(abstractable_from_column.clone, abstractor_suggestion_source.match_value.strip)
                          - else
                            = abstractable_from_column.clone
            .column-3
              = f.select :abstractor_suggestion_status_id, Abstractor::AbstractorSuggestionStatus.all.sort_by(&:name).map{|s| [s.name, s.id]}
    - else
      .column-9
        - abstractor_abstraction.abstractor_subject.abstractor_abstraction_sources.each do |abstractor_abstraction_source|
          - from_method = abstractor_abstraction_source.from_method
          - if about.respond_to?(from_method)
            %span{ :class => 'abstractor_abstraction_source_tooltip_img label', :rel => "#abstraction_text_#{abstractor_abstraction_source.id}", :title => "#{about.class.to_s} #{from_method}"}
              = image_tag('abstractor/page.png', :id => "abstraction_text_link_#{abstractor_abstraction_source.id}")
            %div{ :id => "abstraction_text_#{abstractor_abstraction_source.id}", :class => 'abstractor_abstraction_source_tooltip'}
              - abstractable_from_column = about.send(from_method)
              - unless abstractable_from_column.nil?
                = abstractable_from_column.clone

    .clear